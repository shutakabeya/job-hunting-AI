import { Memory } from '../memory';
import { LTMSQLiteStorage } from '../storage/ltm_sqlite_storage';
import { LongTermMemoryItem } from './long_term_memory_item';

class LongTermMemory extends Memory {
    constructor() {
        const storage = new LTMSQLiteStorage();
        super(storage);
    }

    save(item) {
        if (!(item instanceof LongTermMemoryItem)) {
            throw new Error("Item must be an instance of LongTermMemoryItem");
        }

        const metadata = { ...item.metadata, agent: item.agent, expected_output: item.expectedOutput };
        
        this.storage.save({
            taskDescription: item.task,
            score: metadata.quality,
            metadata: metadata,
            datetime: item.datetime
        });
    }

    search(task, latestN = 3) {
        return this.storage.load(task, latestN);
    }

    reset() {
        this.storage.reset();
    }
}

export { LongTermMemory };