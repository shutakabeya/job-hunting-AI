import chalk from 'chalk';
import { validatePositiveInteger, spawnProcess } from './utils';
import { TRAINED_AGENTS_DATA_FILE } from '../utilities/constants';

async function trainCrew(nIterations, filename = TRAINED_AGENTS_DATA_FILE) {
  try {
    const iterations = validatePositiveInteger(nIterations, "The number of iterations must be a positive integer.");

    if (filename.endsWith('.pkl')) {
      throw new Error("The filename must not end with .pkl");
    }

    await spawnProcess('poetry', ['run', 'train', iterations.toString(), filename]);
  } catch (error) {
    console.error(chalk.red(error.message));
  }
}

export { trainCrew };