import { performance } from 'perf_hooks';

class RPMController {
    constructor(rpm) {
        this.rpm = rpm;
        this.requestTimes = [];
    }

    async waitForNextRequest() {
        const now = performance.now();
        this.requestTimes = this.requestTimes.filter(time => now - time < 60000);

        if (this.requestTimes.length >= this.rpm) {
            const oldestRequest = this.requestTimes[0];
            const timeToWait = 60000 - (now - oldestRequest);
            if (timeToWait > 0) {
                await new Promise(resolve => setTimeout(resolve, timeToWait));
            }
        }

        this.requestTimes.push(performance.now());
    }
}

export { RPMController };